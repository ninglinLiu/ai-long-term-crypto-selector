# AI Long-Term Crypto Selector - é¡¹ç›®æ¶æ„ä¸è¿ä½œåŸç†

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ](#ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ)
2. [æ ¸å¿ƒå·¥ä½œæµç¨‹](#æ ¸å¿ƒå·¥ä½œæµç¨‹)
3. [æ•°æ®æµå›¾](#æ•°æ®æµå›¾)
4. [æ¨¡å—è¯¦è§£](#æ¨¡å—è¯¦è§£)
5. [æŠ€æœ¯æ ˆè¯´æ˜](#æŠ€æœ¯æ ˆè¯´æ˜)

---

## ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·ç•Œé¢å±‚ (Frontend)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Next.js App Router                                       â”‚  â”‚
â”‚  â”‚  - Dashboard (èµ„äº§æ± è¡¨æ ¼ã€ç»„åˆå»ºè®®)                        â”‚  â”‚
â”‚  â”‚  - èµ„äº§è¯¦æƒ…é¡µ (Kçº¿å›¾ã€å› å­åˆ†æ)                           â”‚  â”‚
â”‚  â”‚  - API Routes (æ•°æ®æ¥å£)                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• HTTP/API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸šåŠ¡é€»è¾‘å±‚ (Server)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ æ•°æ®æä¾›å™¨   â”‚  â”‚ å› å­è®¡ç®—å¼•æ“  â”‚  â”‚ ç­–ç•¥å¼•æ“     â”‚          â”‚
â”‚  â”‚ DataProvider â”‚â†’ â”‚ FactorEngine â”‚â†’ â”‚ Strategy     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â†“                  â†“                  â†“                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    LLM é›†æˆå±‚ (DeepSeek)                   â”‚  â”‚
â”‚  â”‚  - èµ„äº§åˆ†æ Prompt                                         â”‚  â”‚
â”‚  â”‚  - ç»„åˆæŠ¥å‘Š Prompt                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• Prisma ORM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®æŒä¹…å±‚ (Database)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Asset        â”‚  â”‚ DailyMarket  â”‚  â”‚ Factor       â”‚          â”‚
â”‚  â”‚ (èµ„äº§è¡¨)     â”‚  â”‚ Data         â”‚  â”‚ Snapshot     â”‚          â”‚
â”‚  â”‚              â”‚  â”‚ (å¸‚åœºæ•°æ®)   â”‚  â”‚ (å› å­å¿«ç…§)   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PortfolioSuggestion (ç»„åˆå»ºè®®è¡¨)                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• HTTP/API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤–éƒ¨æ•°æ®æº (External APIs)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ CoinGecko    â”‚  â”‚ DeepSeek API â”‚                            â”‚
â”‚  â”‚ (ä»·æ ¼æ•°æ®)   â”‚  â”‚ (AIåˆ†æ)     â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒå·¥ä½œæµç¨‹

### 1. æ•°æ®é‡‡é›†æµç¨‹ (`pnpm update-data`)

```mermaid
graph TD
    A[å¼€å§‹: updateData.ts] --> B[è¯»å–èµ„äº§ç™½åå•]
    B --> C[æ£€æŸ¥æ•°æ®åº“ä¸­çš„èµ„äº§è®°å½•]
    C --> D{èµ„äº§æ˜¯å¦å­˜åœ¨?}
    D -->|å¦| E[åˆ›å»ºèµ„äº§è®°å½•]
    D -->|æ˜¯| F[æ›´æ–°æ•°æ®æºID]
    E --> F
    F --> G[éå†æ¯ä¸ªèµ„äº§]
    G --> H[CryptoDataProvider.fetchHistoricalData]
    H --> I[è°ƒç”¨ CoinGecko API]
    I --> J{éœ€è¦ä»£ç†?}
    J -->|æ˜¯| K[é€šè¿‡ä»£ç†è®¿é—®]
    J -->|å¦| L[ç›´æ¥è®¿é—®]
    K --> M[è·å–å†å²æ•°æ® 365å¤©]
    L --> M
    M --> N[è·å–å½“å‰å¸‚åœºæ•°æ®]
    N --> O[å†™å…¥ DailyMarketData è¡¨]
    O --> P{è¿˜æœ‰èµ„äº§?}
    P -->|æ˜¯| G
    P -->|å¦| Q[å®Œæˆ]
```

### 2. å› å­è®¡ç®—æµç¨‹ (`pnpm recompute-factors`)

```mermaid
graph TD
    A[å¼€å§‹: recomputeFactors.ts] --> B[è·å–æ‰€æœ‰èµ„äº§]
    B --> C[è·å–æœ€æ–°å¸‚åœºæ•°æ®æ—¥æœŸ]
    C --> D[éå†æ¯ä¸ªèµ„äº§]
    D --> E[computeRawFactors]
    E --> F[ä»æ•°æ®åº“è¯»å–å†å²æ•°æ®]
    F --> G[è®¡ç®—åŸå§‹å› å­]
    G --> H[ä¼°å€¼å› å­: logå¸‚å€¼/FDVæ¯”/ä»·æ ¼é«˜ç‚¹æ¯”]
    G --> I[åŠ¨é‡å› å­: 90/180/365å¤©æ”¶ç›Šç‡/æ³¢åŠ¨ç‡]
    G --> J[æµåŠ¨æ€§å› å­: æˆäº¤é‡/å¸‚å€¼æ¯”/å¹³å‡æˆäº¤é‡]
    G --> K[é£é™©å› å­: 365å¤©æ³¢åŠ¨ç‡/æœ€å¤§å›æ’¤]
    H --> L[æ”¶é›†æ‰€æœ‰èµ„äº§çš„å› å­]
    I --> L
    J --> L
    K --> L
    L --> M[normalizeFactorScores]
    M --> N[ä½¿ç”¨åˆ†ä½æ•°æ–¹æ³•æ ‡å‡†åŒ–]
    N --> O[è®¡ç®—æ€»åˆ†: åŠ æƒå¹³å‡]
    O --> P[ä¿å­˜åˆ° FactorSnapshot è¡¨]
    P --> Q[generatePortfolioSuggestion]
    Q --> R[æ ¹æ®æ€»åˆ†è®¡ç®—æƒé‡]
    R --> S[ä¿å­˜åˆ° PortfolioSuggestion è¡¨]
    S --> T[å®Œæˆ]
```

### 3. AI æŠ¥å‘Šç”Ÿæˆæµç¨‹ (`pnpm generate-report`)

```mermaid
graph TD
    A[å¼€å§‹: generateReport.ts] --> B[æ£€æŸ¥ DeepSeek API Key]
    B --> C[è·å–æœ€æ–°ç»„åˆå»ºè®®]
    C --> D{ç»„åˆå»ºè®®å­˜åœ¨?}
    D -->|å¦| E[ç”Ÿæˆæ–°çš„ç»„åˆå»ºè®®]
    D -->|æ˜¯| F[ä½¿ç”¨ç°æœ‰å»ºè®®]
    E --> F
    F --> G[æ„å»ºç»„åˆæŠ¥å‘Š Prompt]
    G --> H[è°ƒç”¨ DeepSeek API]
    H --> I[è·å– AI åˆ†ææŠ¥å‘Š]
    I --> J{éœ€è¦å•ä¸ªèµ„äº§åˆ†æ?}
    J -->|æ˜¯| K[éå†å‰5ä¸ªèµ„äº§]
    J -->|å¦| L[è·³è¿‡]
    K --> M[æ„å»ºèµ„äº§åˆ†æ Prompt]
    M --> N[è°ƒç”¨ DeepSeek API]
    N --> O[è·å–èµ„äº§åˆ†æ]
    O --> P{è¿˜æœ‰èµ„äº§?}
    P -->|æ˜¯| K
    P -->|å¦| Q[ç”Ÿæˆ Markdown æŠ¥å‘Š]
    L --> Q
    Q --> R[ä¿å­˜åˆ° reports/ ç›®å½•]
    R --> S[å®Œæˆ]
```

### 4. å‰ç«¯å±•ç¤ºæµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·è®¿é—® Dashboard] --> B[Next.js Server Component]
    B --> C[è°ƒç”¨ /api/assets]
    C --> D[Prisma æŸ¥è¯¢æ•°æ®åº“]
    D --> E[è¿”å›èµ„äº§æ•°æ® + å› å­å¾—åˆ†]
    E --> F[æ¸²æŸ“èµ„äº§è¡¨æ ¼]
    F --> G[ç”¨æˆ·ç‚¹å‡»èµ„äº§è¯¦æƒ…]
    G --> H[è°ƒç”¨ /api/asset/[id]]
    H --> I[Prisma æŸ¥è¯¢å•ä¸ªèµ„äº§]
    I --> J[è¿”å›ä»·æ ¼å†å² + å› å­æ•°æ®]
    J --> K[æ¸²æŸ“ Kçº¿å›¾ + é›·è¾¾å›¾]
    K --> L[ç”¨æˆ·æŸ¥çœ‹ç»„åˆå»ºè®®]
    L --> M[è°ƒç”¨ /api/portfolio]
    M --> N[Prisma æŸ¥è¯¢ç»„åˆå»ºè®®]
    N --> O[æ¸²æŸ“æƒé‡åˆ†å¸ƒ]
```

---

## æ•°æ®æµå›¾

### å®Œæ•´æ•°æ®æµ

```
å¤–éƒ¨æ•°æ®æº (CoinGecko)
    â”‚
    â”‚ HTTP/API (æ”¯æŒä»£ç†)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CryptoDataProvider             â”‚
â”‚  - fetchHistoricalData()        â”‚
â”‚  - fetchCurrentMarketData()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ åŸå§‹å¸‚åœºæ•°æ®
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DailyMarketData (æ•°æ®åº“è¡¨)      â”‚
â”‚  - price, marketCap, volume      â”‚
â”‚  - date, high, low, open         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ å†å²æ•°æ®æŸ¥è¯¢
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FactorEngine                   â”‚
â”‚  - computeRawFactors()          â”‚
â”‚  - normalizeFactorScores()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ å› å­å¾—åˆ† (0-5åˆ†)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FactorSnapshot (æ•°æ®åº“è¡¨)      â”‚
â”‚  - valuationScore               â”‚
â”‚  - momentumScore                â”‚
â”‚  - liquidityScore               â”‚
â”‚  - riskScore                    â”‚
â”‚  - totalScore                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ å› å­å¾—åˆ†
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Strategy Engine                â”‚
â”‚  - calculateTargetWeight()      â”‚
â”‚  - generatePortfolioSuggestion()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ æƒé‡åˆ†é…
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PortfolioSuggestion (æ•°æ®åº“è¡¨) â”‚
â”‚  - assetId, targetWeight         â”‚
â”‚  - date                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ ç»„åˆå»ºè®® + å› å­æ•°æ®
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DeepSeek LLM                   â”‚
â”‚  - buildPortfolioReportPrompt() â”‚
â”‚  - buildAssetAnalysisPrompt()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ AI åˆ†ææŠ¥å‘Š
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  reports/portfolio-YYYY-MM-DD.mdâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ æ‰€æœ‰æ•°æ®
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend Dashboard             â”‚
â”‚  - è¡¨æ ¼å±•ç¤º                     â”‚
â”‚  - å›¾è¡¨å¯è§†åŒ–                   â”‚
â”‚  - æŠ¥å‘Šå±•ç¤º                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ¨¡å—è¯¦è§£

### 1. æ•°æ®å±‚ (Data Layer)

#### 1.1 æ•°æ®æä¾›å™¨ (`src/server/data-providers/`)

```
IDataProvider (æ¥å£)
    â”‚
    â””â”€â”€ CryptoDataProvider (å®ç°)
        â”œâ”€â”€ fetchUniverse()          # è·å–èµ„äº§æ± 
        â”œâ”€â”€ fetchHistoricalData()    # è·å–å†å²æ•°æ®
        â””â”€â”€ fetchCurrentMarketData() # è·å–å½“å‰æ•°æ®
```

**èŒè´£ï¼š**
- å°è£…å¤–éƒ¨ API è°ƒç”¨ï¼ˆCoinGeckoï¼‰
- å¤„ç†ä»£ç†é…ç½®
- æ•°æ®æ ¼å¼è½¬æ¢

#### 1.2 æ•°æ®åº“æ¨¡å‹ (`prisma/schema.prisma`)

```
Asset (èµ„äº§è¡¨)
â”œâ”€â”€ id, symbol, name
â”œâ”€â”€ assetClass, dataSourceId
â””â”€â”€ å…³è”å…³ç³»
    â”œâ”€â”€ dailyMarketData (1:N)
    â”œâ”€â”€ factorSnapshots (1:N)
    â””â”€â”€ portfolioSuggestions (1:N)

DailyMarketData (å¸‚åœºæ•°æ®è¡¨)
â”œâ”€â”€ assetId, date
â”œâ”€â”€ price, marketCap, volume
â””â”€â”€ fdv, high, low, open

FactorSnapshot (å› å­å¿«ç…§è¡¨)
â”œâ”€â”€ assetId, date
â”œâ”€â”€ valuationScore, momentumScore
â”œâ”€â”€ liquidityScore, riskScore
â””â”€â”€ totalScore, rawFactors (JSON)

PortfolioSuggestion (ç»„åˆå»ºè®®è¡¨)
â”œâ”€â”€ assetId, date
â””â”€â”€ targetWeight, notes
```

### 2. å› å­è®¡ç®—å±‚ (Factor Layer)

#### 2.1 å› å­å®šä¹‰ (`src/server/factors/factorDefinitions.ts`)

```typescript
RawFactors {
  // ä¼°å€¼å› å­
  logMarketCap: number
  fdvToMarketCapRatio: number
  priceToHigh365d: number
  
  // åŠ¨é‡å› å­
  return90d, return180d, return365d: number
  volatility90d, volatility180d: number
  
  // æµåŠ¨æ€§å› å­
  volumeToMarketCapRatio: number
  avgDailyVolume30d: number
  
  // é£é™©å› å­
  volatility365d: number
  maxDrawdown365d: number
}

FactorScores {
  valuationScore: number  // 0-5
  momentumScore: number   // 0-5
  liquidityScore: number  // 0-5
  riskScore: number       // 0-5
  totalScore: number      // 0-5
}
```

#### 2.2 å› å­è®¡ç®— (`src/server/factors/computeFactors.ts`)

**è®¡ç®—æ­¥éª¤ï¼š**
1. ä»æ•°æ®åº“è¯»å–å†å²æ•°æ®ï¼ˆè‡³å°‘ 365 å¤©ï¼‰
2. è®¡ç®—åŸå§‹å› å­å€¼
3. ä½¿ç”¨åˆ†ä½æ•°æ–¹æ³•æ ‡å‡†åŒ–ï¼ˆåŸºäºæ‰€æœ‰èµ„äº§ï¼‰
4. åŠ æƒå¹³å‡è®¡ç®—æ€»åˆ†

**æƒé‡åˆ†é…ï¼š**
- ä¼°å€¼ï¼š25%
- åŠ¨é‡ï¼š30%
- æµåŠ¨æ€§ï¼š20%
- é£é™©ï¼š25%

### 3. ç­–ç•¥å±‚ (Strategy Layer)

#### 3.1 è¯„åˆ†è§„åˆ™ (`src/server/strategy/scoring.ts`)

```
æ€»åˆ†é˜ˆå€¼ â†’ ç›®æ ‡æƒé‡æ˜ å°„ï¼š
- â‰¥ 4.0  â†’ 4%
- 3.5-4.0 â†’ 2%
- 3.0-3.5 â†’ 1%
- < 3.0  â†’ 0% (ä¸æŒæœ‰)
```

#### 3.2 ç»„åˆå»ºè®® (`src/server/strategy/portfolio.ts`)

**æµç¨‹ï¼š**
1. è·å–æ‰€æœ‰èµ„äº§çš„å› å­å¾—åˆ†
2. æ ¹æ®è¯„åˆ†è§„åˆ™è®¡ç®—ç›®æ ‡æƒé‡
3. å½’ä¸€åŒ–æƒé‡ï¼ˆç¡®ä¿æ€»æƒé‡ â‰¤ 100%ï¼‰
4. ä¿å­˜åˆ°æ•°æ®åº“

### 4. LLM é›†æˆå±‚ (LLM Layer)

#### 4.1 DeepSeek å®¢æˆ·ç«¯ (`src/server/llm/deepseekClient.ts`)

```typescript
DeepSeekClient {
  chat(messages, options)      # è°ƒç”¨ API
  chatSimple(userMessage)      # ç®€åŒ–è°ƒç”¨
}
```

#### 4.2 Prompt æ¨¡æ¿

**èµ„äº§åˆ†æ Promptï¼š**
- è¾“å…¥ï¼šèµ„äº§ä¿¡æ¯ + å› å­å¾—åˆ† + åŸå§‹å› å­å€¼
- è¾“å‡ºï¼šå¤šç»´åº¦åˆ†æï¼ˆä¼°å€¼ã€åŠ¨é‡ã€æµåŠ¨æ€§ã€é£é™©ï¼‰

**ç»„åˆæŠ¥å‘Š Promptï¼š**
- è¾“å…¥ï¼šç»„åˆå»ºè®® + èµ„äº§é…ç½®
- è¾“å‡ºï¼šMarkdown æ ¼å¼æŠ•èµ„ç»„åˆåˆ†ææŠ¥å‘Š

### 5. å‰ç«¯å±‚ (Frontend Layer)

#### 5.1 é¡µé¢ç»“æ„

```
/app
â”œâ”€â”€ page.tsx              # ä¸» Dashboard
â”‚   â”œâ”€â”€ èµ„äº§æ± è¡¨æ ¼
â”‚   â””â”€â”€ ç»„åˆå»ºè®®æ ‡ç­¾é¡µ
â”‚
â””â”€â”€ assets/[id]/page.tsx  # èµ„äº§è¯¦æƒ…é¡µ
    â”œâ”€â”€ æ¦‚è§ˆæ ‡ç­¾
    â”œâ”€â”€ ä»·æ ¼èµ°åŠ¿æ ‡ç­¾ (Kçº¿å›¾)
    â””â”€â”€ å› å­åˆ†ææ ‡ç­¾ (é›·è¾¾å›¾)
```

#### 5.2 API è·¯ç”±

```
/api
â”œâ”€â”€ assets/route.ts        # GET: è·å–æ‰€æœ‰èµ„äº§æ•°æ®
â”œâ”€â”€ portfolio/route.ts     # GET: è·å–ç»„åˆå»ºè®®
â”œâ”€â”€ asset/[id]/route.ts    # GET: è·å–å•ä¸ªèµ„äº§è¯¦æƒ…
â””â”€â”€ report/route.ts        # GET: è·å–æœ€æ–°æŠ¥å‘Š
```

---

## æŠ€æœ¯æ ˆè¯´æ˜

### åç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç”¨é€” |
|------|------|
| **Next.js 14** | å…¨æ ˆæ¡†æ¶ï¼ŒServer Components + API Routes |
| **TypeScript** | ç±»å‹å®‰å…¨ |
| **Prisma** | ORMï¼Œæ•°æ®åº“æ“ä½œ |
| **SQLite** | å¼€å‘ç¯å¢ƒæ•°æ®åº“ |
| **Axios** | HTTP å®¢æˆ·ç«¯ |
| **https-proxy-agent** | ä»£ç†æ”¯æŒ |

### å‰ç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç”¨é€” |
|------|------|
| **React 18** | UI æ¡†æ¶ |
| **TailwindCSS** | æ ·å¼æ¡†æ¶ |
| **shadcn/ui** | UI ç»„ä»¶åº“ |
| **Recharts** | å›¾è¡¨åº“ |
| **react-markdown** | Markdown æ¸²æŸ“ |

### å¤–éƒ¨æœåŠ¡

| æœåŠ¡ | ç”¨é€” |
|------|------|
| **CoinGecko API** | åŠ å¯†è´§å¸ä»·æ ¼æ•°æ® |
| **DeepSeek API** | AI åˆ†ææŠ¥å‘Šç”Ÿæˆ |

---

## å…¸å‹ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šæ¯æ—¥æ•°æ®æ›´æ–°

```bash
# 1. æ‹‰å–æœ€æ–°æ•°æ®
pnpm update-data
# â†’ è°ƒç”¨ CoinGecko API
# â†’ å†™å…¥ DailyMarketData è¡¨

# 2. è®¡ç®—å› å­
pnpm recompute-factors
# â†’ ä» DailyMarketData è¯»å–æ•°æ®
# â†’ è®¡ç®—å› å­å¾—åˆ†
# â†’ å†™å…¥ FactorSnapshot è¡¨
# â†’ ç”Ÿæˆç»„åˆå»ºè®®
# â†’ å†™å…¥ PortfolioSuggestion è¡¨

# 3. ç”Ÿæˆ AI æŠ¥å‘Š
pnpm generate-report
# â†’ ä»æ•°æ®åº“è¯»å–ç»„åˆå»ºè®®
# â†’ è°ƒç”¨ DeepSeek API
# â†’ ç”Ÿæˆ Markdown æŠ¥å‘Š
```

### åœºæ™¯ 2ï¼šæŸ¥çœ‹ Dashboard

```
ç”¨æˆ·è®¿é—® http://localhost:3000
    â†“
Next.js Server Component æ¸²æŸ“
    â†“
è°ƒç”¨ /api/assets è·å–æ•°æ®
    â†“
Prisma æŸ¥è¯¢æ•°æ®åº“
    â†“
è¿”å› JSON æ•°æ®
    â†“
æ¸²æŸ“è¡¨æ ¼å’Œå›¾è¡¨
```

---

## å…³é”®è®¾è®¡å†³ç­–

### 1. ä¸ºä»€ä¹ˆä½¿ç”¨ SQLiteï¼Ÿ

- **å¼€å‘ç¯å¢ƒ**ï¼šç®€å•ï¼Œæ— éœ€é¢å¤–æœåŠ¡
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šå¯è½»æ¾åˆ‡æ¢åˆ° PostgreSQL
- **æ•°æ®é‡**ï¼šé•¿æœŸæŠ•èµ„ï¼Œæ•°æ®é‡ä¸å¤§

### 2. ä¸ºä»€ä¹ˆæ‰‹åŠ¨è§¦å‘ï¼Ÿ

- **ä½é¢‘æŠ•èµ„**ï¼šä¸éœ€è¦å®æ—¶æ•°æ®
- **æˆæœ¬æ§åˆ¶**ï¼šé¿å…é¢‘ç¹ API è°ƒç”¨
- **çµæ´»æ€§**ï¼šç”¨æˆ·æ§åˆ¶æ›´æ–°æ—¶æœº

### 3. ä¸ºä»€ä¹ˆä½¿ç”¨åˆ†ä½æ•°æ ‡å‡†åŒ–ï¼Ÿ

- **ç›¸å¯¹è¯„åˆ†**ï¼šåŸºäºèµ„äº§æ± å†…æ¯”è¾ƒ
- **åŠ¨æ€è°ƒæ•´**ï¼šéšå¸‚åœºå˜åŒ–è‡ªåŠ¨è°ƒæ•´
- **å…¬å¹³æ€§**ï¼šé¿å…ç»å¯¹å€¼åå·®

### 4. ä¸ºä»€ä¹ˆæ”¯æŒä»£ç†ï¼Ÿ

- **ä¸­å›½ç”¨æˆ·**ï¼šCoinGecko å¯èƒ½è¢«å¢™
- **çµæ´»æ€§**ï¼šæ”¯æŒå„ç§ä»£ç†å·¥å…·
- **ç¯å¢ƒå˜é‡**ï¼šä¸ç¡¬ç¼–ç ï¼Œä¾¿äºé…ç½®

---

## æ‰©å±•æ€§è®¾è®¡

### æœªæ¥æ”¯æŒ A è‚¡/ç¾è‚¡

```
IDataProvider (æ¥å£)
â”œâ”€â”€ CryptoDataProvider (å½“å‰å®ç°)
â”œâ”€â”€ USEquityDataProvider (æœªæ¥)
â””â”€â”€ CNEquityDataProvider (æœªæ¥)

Asset.assetClass
â”œâ”€â”€ 'crypto' (å½“å‰)
â”œâ”€â”€ 'us_equity' (æœªæ¥)
â””â”€â”€ 'cn_equity' (æœªæ¥)
```

### å› å­è®¡ç®—æ‰©å±•

- ä¸åŒèµ„äº§ç±»åˆ«å¯ä½¿ç”¨ä¸åŒå› å­
- å› å­æƒé‡å¯é…ç½®
- æ”¯æŒè‡ªå®šä¹‰å› å­

---

## æ€»ç»“

è¿™æ˜¯ä¸€ä¸ª**æ•°æ®é©±åŠ¨çš„é•¿æœŸæŠ•èµ„å†³ç­–ç³»ç»Ÿ**ï¼Œæ ¸å¿ƒæµç¨‹ï¼š

1. **æ•°æ®é‡‡é›†** â†’ ä» CoinGecko è·å–å¸‚åœºæ•°æ®
2. **å› å­è®¡ç®—** â†’ åŸºäºå†å²æ•°æ®è®¡ç®—æŠ•èµ„å› å­
3. **ç­–ç•¥æ‰§è¡Œ** â†’ æ ¹æ®å› å­å¾—åˆ†ç”Ÿæˆç»„åˆå»ºè®®
4. **AI åˆ†æ** â†’ ä½¿ç”¨ DeepSeek ç”Ÿæˆä¸“ä¸šæŠ¥å‘Š
5. **å¯è§†åŒ–å±•ç¤º** â†’ å‰ç«¯ Dashboard å±•ç¤ºç»“æœ

æ•´ä¸ªç³»ç»Ÿé‡‡ç”¨**åˆ†å±‚æ¶æ„**ï¼Œå„æ¨¡å—èŒè´£æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚

